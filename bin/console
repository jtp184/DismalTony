#!/usr/bin/env ruby

require 'bundler/setup'
require 'dismaltony'
require 'dismaltony/directives/core'
require 'dismaltony/directives/conversation'
require 'dismaltony/directives/weather'

# You can add fixtures and/or initialization code here to make experimenting
# with your gem easier. You can also use a different console, if you like.
require 'psych'
require 'ParseyParse'
require 'ParseyParse/cache'
require 'pp'

ParseyParse.configure do |conf|
  conf[:cache] = begin
    ParseyParse::YAMLCache.load_from('./tmp/cache.yml')
  rescue
    ParseyParse::Cache.new
  end
end

@db = begin
  DismalTony::YAMLStore.load_from('./tmp/tony.yml')
rescue
  DismalTony::DataStore.new
end

DismalTony.vi = DismalTony::VIBase.new(
  :data_store => @db,
  :user => @db.users.first
  )

@last = nil

def self.interactive(debug = false)
  puts
  loop do
    print "[#{DismalTony::EmojiDictionary['laptop']}  ]: "
    inp = gets.chomp
    puts
    res = @tony.(inp)
    puts
    @last = res if debug
  end
end

# (If you use this, don't forget to add pry to your Gemfile!)
require 'pry'
Pry.start

# require 'irb'
# IRB.start
